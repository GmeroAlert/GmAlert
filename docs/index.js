!function(){"use strict";var e={on(e,t,n,o){e.addEventListener(t,n,o)},off(e,t,n){e.removeEventListener(t,n)}};function t(e){return`gmal-${e}`}function n(e,...t){const n=document.createElement(e);return n.classList.add(...t),n}function o(...e){return n("div",...e)}const i=()=>{let e=a(".gmal");return e||(e=o("gmal"),document.body.append(e)),e};function s(e,t){const n=e.style.cssText.split(";");n.pop(),e.style.cssText=`${n.concat(t).join(";")};`}function r(e,t){t.forEach((t=>{e.style.removeProperty(t)}))}function c(e=!0){const t=document.body;e?s(t,["overflow: hidden",`padding-right: ${window.innerWidth-document.documentElement.clientWidth}px`]):r(t,["overflow","padding-right"])}function a(e,t=document.body){return t.querySelector(e)}function l(t,n){e.on(t,"animationend",(e=>{n(e.animationName)}))}function u(e,t){r(e,["animation-name"]),e.offsetHeight,s(e,[`animation-name:${t}`])}class m{conf={timeout:2500};id=0;insts=new Map;constructor(e,t){this.conf={...this.conf,...t},this.core=e}config(e){this.conf={...this.conf,...e}}fire(e){const t=this.mkMsg(e);return this.sT(t,e?.timeout),t}sT(e,t){if(0===t)return;t=t||this.conf.timeout;const{$el:n}=e,o=this.mkP(e,t);o.resume(),n.onmouseenter=o.pause,n.onmouseleave=o.resume}mkP(e,n){e.progress?.remove();const{$el:i}=e,r=o(t("progress")),c=o(t("progress-bar"));r.append(c),i.append(r),c.ontransitionend=()=>{e.close(-1)};const a=()=>c.clientWidth/r.clientWidth;return e.progress={pause:()=>{s(c,["transition:none",`width:${100*a()}%`])},resume:()=>{s(c,["width:100%",`transition:width ${n*(1-a())}ms linear`])},remove:()=>{r.remove()}}}mkMsg(e){const t=this.id++,n={...this.conf,...e,content:e.content||"",onClosed:t=>{e?.onClosed&&e.onClosed(t)},beforeClose:async n=>{if(e?.beforeClose){if(!await e.beforeClose(n))return!1}return this.insts.delete(t),!0}},o=this.core(n);let i=!1;const r=()=>{i||(i=!0,o.open())};n.className&&o.$el.classList.add(...n.className),n.style&&s(o.$el,n.style);const c=this.insts.values().next().value;c&&(c.progress?.pause(),c.close(-2));const a={...o,open:r};return this.insts.set(t,a),r(),a}}function d(e,t){const n=new m(e,t),o=(...e)=>n.fire(function(e){const t={content:"success"};let n=!1;const o=e=>{switch(typeof e){case"string":n?t.text=e:(t.content=e,n=!0);break;case"number":t.timeout=e;break;case"object":Object.assign(t,e)}};for(let t=0;t<4;t++)o(e[t]);return t}(e));return o.config=n.config.bind(n),o}function f(e="1em"){return`<svg width="${e}" height="${e}" viewBox="0 0 24 24"><g stroke="currentColor"><circle cx="12" cy="12" r="9.5" fill="none" stroke-linecap="round" stroke-width="2"><animate attributeName="stroke-dasharray" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0 150;42 150;42 150;42 150"/><animate attributeName="stroke-dashoffset" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0;-16;-59;-59"/></circle><animateTransform attributeName="transform" dur="2s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></g></svg>`}function p(e,o){const i=n("button",t("hairline"));i.textContent=e;let s=!1;return i.onclick=async()=>{s||(s=!0,setTimeout((()=>{s&&(i.innerHTML=f("1.4em"))}),50),await o(),i.textContent=e,s=!1)},i.classList.add(t("alert-btn")),i}let h=0;function b(e){let n=a(`.${t("overlay")}`);if(n||(n=o(t("overlay")),i().append(n),l(n,(e=>{e===t("fade-in")&&(h=3),e===t("fade-out")&&(h=0,c(!1),s(n,["display: none"]))}))),e){if(h>1)return n;c(),h=2,u(n,t("fade-in")),s(n,["display: block"])}else{if(h<2)return n;h=1,u(n,t("fade-out"))}return n}function g(n){const s=o(t("alert"));let r,c=!1;if(n.content&&(s.innerHTML=`<div class="${t("alert-title")}">${n.content}</div>`),n.text||n.html){const e=o(t("alert-content"));n.html?"string"==typeof n.html?e.innerHTML=n.html:e.append(n.html):e.textContent=n.text,s.append(e)}const m=()=>{u(s,t("shake"))},d=async o=>{if(c)return void m();c=!0;if(!await n.beforeClose(o))return c=!1,void m();const i=a(`.${t("overlay")}`);return-2!==o&&b(!1),e.off(i,"click",r),u(s,t("alert-out")),new Promise((e=>{l(s,(i=>{i===t("alert-out")&&(s.remove(),n.onClosed(o),e())}))}))};r=()=>{d(-3)};if(n.cancelLabel||n.confirmLabel){const e=o(t("alert-btn-group"),t("hairline"));n.cancelLabel&&e.append(p(n.cancelLabel,(async()=>{await d(2)}))),n.confirmLabel&&e.append(p(n.confirmLabel,(async()=>{await d(1)}))),s.append(e)}return{close:d,open:()=>{e.on(b(!0),"click",r),i().append(s),u(s,t("alert-in"))},$el:s}}const v=d(g,{timeout:0,confirmLabel:"确定"});function w(e){const n=o(t("msg")),s=o(t("msg-main"));s.innerHTML=`<div class=${t("msg-content")}>${e.content}</div>`,n.append(s);let r=e.icon||"";"loading"===r&&(r=f());const c=o(t("icon"));c.innerHTML=r,r&&s.prepend(c);return{open:()=>{i().append(n),u(n,t("alert-in"))},close:async o=>{if(await e.beforeClose(o))return u(n,t("alert-out")),new Promise((i=>{l(n,(s=>{s===t("alert-out")&&(n.remove(),e.onClosed(o),i())}))}))},$el:n}}const y=d(w);function k(e){const n=o(t("notice"));s(n,[e.bottom?"bottom:0":"top:0",e.bottom?"--y:100%":"--y:-100%",e.background?`background:${e.background}`:"",e.color?`color:${e.color}`:""]),n.innerHTML=`<div class="${t("notice-main")}"><div class="${t("notice-content")}">${e.content}</div></div>`;return{open:()=>{i().append(n),u(n,t("open"))},close:async o=>{if(await e.beforeClose(o))return u(n,t("close")),new Promise((i=>{l(n,(s=>{s===t("close")&&(n.remove(),e.onClosed(o),i())}))}))},$el:n}}const $=d(k);function C(e,t){const n=document.createElement("button");return n.classList.add("btn"),n.textContent=e,n.onclick=t,n}function L(...e){const t=o("btn-box");return t.append(...e),t}function x(){v("this is a normal alert")}function T(){v("this is a alert with content,text",{content:"content",text:"text"})}function M(){v("this is a alert with button",{text:"我们可以使用 beforeClose 来实现异步关闭或设置默认关闭行为，比如阻止点击遮罩关闭",cancelLabel:"cancel",confirmLabel:"confirm",beforeClose:e=>-3!==e&&new Promise((t=>{setTimeout((()=>{t(1===e)}),1500)}))})}function N(){const e=o("gm-label"),t=n("span");t.textContent="网站名称：";const i=n("input","gm-input");e.append(t,i),v("this is a alert with html",{html:e,confirmLabel:"提交",beforeClose:e=>1!==e||(console.log("submit"),new Promise((e=>{setTimeout((()=>{e(!0),i.value?y(`我们收到了您的申请：${i.value}`):y("您没有输入任何东西")}),1500)})))})}var E=L(C("Normal Alert",x),C("Alert With Content",T),C("Alert With Button",M),C("Alert With Html",N));function H(){y("this is a normal message")}function P(){y("this is a message with icon",{icon:"loading"})}var W=L(C("Normal Message",H),C("Message with Icon",P));function A(){$("this is a normal notice")}function B(){$("this is a notice at bottom",{bottom:!0})}function j(){$("this is a message with custom color",{background:"red",color:"white"})}var S=L(C("Normal Notice",A),C("Bottom Notice",B),C("Notice with Background",j));$.config({timeout:5e3});const q=a("#root");if(!q)throw new Error("Root element not found");function I(e){const t=o("area"),n=document.createElement("h3");return n.textContent=e,t.append(n),t}q.innerHTML="";const O=I("Alert");O.append(E);const R=I("Message");R.append(W);const z=I("Notice");z.append(S),q.append(C("changeTheme",(()=>{document.documentElement.dataset.theme="dark"===document.documentElement.dataset.theme?"light":"dark"})),O,R,z)}();
